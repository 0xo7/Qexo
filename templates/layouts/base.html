<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="canonical" href="https://github.com/Qexo/Qexo">

    <title>
        {{ QEXO_NAME }}{{ QEXO_SPLIT }}{% block title %}{% endblock %}
    </title>

    <!-- Favicon - loaded as static -->
    <link rel="shortcut icon" href="{{ QEXO_ICON }}">
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
    <!-- Icons -->
    <link rel="stylesheet"
          href="{{ cdnjs }}argon-dashboard-react/1.2.0/assets/plugins/nucleo/css/nucleo.css"
          type="text/css">
    <link rel="stylesheet"
          href="{{ cdnjs }}font-awesome/5.15.4/css/all.min.css"
          type="text/css">
    <link rel="stylesheet"
          href="{{ cdnjs }}notyf/3.5.1/notyf.min.css"
          type="text/css">
    <!-- Page plugins -->
    <!-- Argon CSS -->
    <link rel="stylesheet"
          href="{{ cdnjs }}argon-dashboard-django/1.0.2/css/argon.min.css"
          type="text/css">
    <!-- Specific CSS goes HERE -->
    {% block stylesheets %}
        <style>
            .notyf__toast {
                max-width: 24em !important;
            }

            .notyf__ripple {
                height: 60em !important;
                width: 60em !important;
            }
        </style>
    {% endblock stylesheets %}
</head>

<body class="">

{% include "includes/sidenav.html" %}

<div class="main-content" id="panel">

    {% include "includes/navigation.html" %}

    {% block content %}{% endblock content %}

</div>

{% include "includes/scripts.html" %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    <script>
        function showNotifications() {
            if (!notifications.length) {
                $("#notification-board").html('<div class="list-group list-group-flush"><ul ' +
                    'href="#!" class="list-group-item list-group-item-action"><div class="row ' +
                    'align-items-center"><div class="col-auto"><i class="fas ' +
                    'fa-check"></i></div><div class="col ml--2"><div class="d-flex ' +
                    'justify-content-between align-items-center"><div><h4 class="mb-0 ' +
                    'text-sm">消息</h4></div></div><p class="text-sm ' +
                    'mb-0">你当前没有消息哟~</p></div></div></ul></div>');
                $("#msg-point").css({"background": "inherit"});
            } else {
                let html = '<div class="px-3 py-3"><h6 class="text-sm text-muted m-0">你有 ' +
                    '<strong class="text-primary">' + notifications.length + '</strong> 则消息' +
                    '</h6></div><div class="list-group list-group-flush">';
                for (let i = 0; i < notifications.length; i++) {
                    html += '<a href="javascript:delNotification(\'' + notifications[i]["timestamp"]
                        + '\')" ' + 'class="list-group-item list-group-item-action"><div ' +
                        'class="row align-items-center"><div class="col-auto"><i class="fas ' +
                        'fa-quote-left"></i></div><div class="col ml--2"><div ' +
                        'class="d-flex justify-content-between align-items-center"><div><h4 ' +
                        'class="mb-0 text-sm">' + notifications[i]["label"] + '</h4></div><div ' +
                        'class="text-right text-muted"><small>' + notifications[i]["time"] +
                        '</small></div></div><p class="text-sm mb-0">' +
                        notifications[i]["content"] + '</p></div></div></a>';
                }
                html += '<div class="px-3 py-3"><h6 class="text-sm text-primary m-0 text-right" ' +
                    'style="cursor: pointer" onclick="clearNotification()">清除全部' +
                    '</h6></div>'
                $("#notification-board").html(html + '</div>');
                $("#msg-point").css({
                    "position": "absolute", "top": "0px", "right": "12px", "width": "6px",
                    "height": "6px", "background": "red", "border-radius": "50%"
                });
            }
        }

        $.ajax({
            url: "/api/get_notifications/",
            type: "get",
            success: function (res) {
                let data = JSON.parse(res);
                if (data["status"]) {
                    notifications = data["data"];
                    showNotifications();
                } else {
                    $("#notification-board").html('<div class="list-group list-group-flush"><ul ' +
                        'href="#!" class="list-group-item list-group-item-action"><div class="row ' +
                        'align-items-center"><div class="col-auto"><i class="fas ' +
                        'fa-exclamation-triangle"></i></div><div class="col ml--2"><div class="d-flex ' +
                        'justify-content-between align-items-center"><div><h4 class="mb-0 ' +
                        'text-sm">消息</h4></div></div><p class="text-sm ' +
                        'mb-0">获取失败咯~</p></div></div></ul></div>');
                }
            }
        })

        function delNotification(timestamp) {
            $.ajax({
                url: "/api/del_notifications/",
                type: "post",
                dataType: "JSON",
                data: {"time": timestamp},
                success: function (res) {
                    if (res.status) {
                        notyf.success(res.msg);
                        for (let i = 0; i < notifications.length; i++) {
                            if (notifications[i]["timestamp"] === timestamp) {
                                notifications.splice(i, 1);
                                break;
                            }
                        }
                        showNotifications();
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    notyf.error("网络错误!");
                }
            })
        }

        function clearNotification() {
            $.ajax({
                url: "/api/clear_notifications/",
                type: "post",
                dataType: "JSON",
                success: function (res) {
                    if (res.status) {
                        notyf.success(res.msg);
                        notifications = [];
                        showNotifications();
                    } else {
                        notyf.error(res.msg);
                    }
                },
                error: function (res) {
                    notyf.error("网络错误!");
                }
            })
        }
    </script>
{% endblock javascripts %}

<script src="{{ cdnjs }}argon-dashboard-django/1.0.2/js/argon.min.js"></script>

</body>

</html>
